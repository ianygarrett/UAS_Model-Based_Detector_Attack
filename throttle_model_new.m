function [Tp] = throttle_model_new(V,Throttle)

% Measurement from plane at zero airspeed
% PWM (microseconds)       RPM
rpm_test = [1100		0;
            1180		0;
            1262		1590;
            1294		1890;
            1324		2160;	
            1385		2850;
            1417		3180;
            1447		3420;	
            1478		3750;
            1510		4140;
            1541		4530;
            1583		4980;
            1635		5580;
            1673		5910;
            1697		6240;
            1728		6480;
            1791		6660;
            2100        6660];

% From static thrust setup
% rpm_test = [1100  0
%             1198    0
%             1261    1410
%             1292    1710
%             1311    1920
%             1322    2040
%             1354    2520
%             1386    2910
%             1418    3120
%             1454    3420
%             1499    3810
%             1540    4260
%             1573    4590
%             1603    4950
%             1634    5280
%             1667    5640
%             1699    5880
%             1727    6150
%             1792    6600
%             1853    6750
%             1950    6750];
        
        
table0 = [ 0.0000	1000.0000	  1.1032
  0.1788	1000.0000	  1.0987
  0.4023	1000.0000	  1.0943
  0.5812	1000.0000	  1.0854
  0.8047	1000.0000	  1.0765
  0.9835	1000.0000	  1.0631
  1.1623	1000.0000	  1.0453
  1.3858	1000.0000	  1.0231
  1.5646	1000.0000	  1.0008
  1.7882	1000.0000	  0.9742
  1.9670	1000.0000	  0.9430
  2.1905	1000.0000	  0.9119
  2.3693	1000.0000	  0.8763
  2.5481	1000.0000	  0.8407
  2.7716	1000.0000	  0.8007
  2.9505	1000.0000	  0.7562
  3.1740	1000.0000	  0.7117
  3.3528	1000.0000	  0.6628
  3.5316	1000.0000	  0.6139
  3.7551	1000.0000	  0.5649
  3.9340	1000.0000	  0.5115
  4.1575	1000.0000	  0.4582
  4.3363	1000.0000	  0.4048
  4.5598	1000.0000	  0.3514
  4.7386	1000.0000	  0.2936
  4.9174	1000.0000	  0.2358
  5.1410	1000.0000	  0.1779
  5.3198	1000.0000	  0.1201
  5.5433	1000.0000	  0.0578
  5.7221	1000.0000	  0.0000];

table1 = [  0.0000	2000.0000	  3.1126
  0.4023	2000.0000	  3.0993
  0.8047	2000.0000	  3.0770
  1.1623	2000.0000	  3.0459
  1.5646	2000.0000	  3.0059
  1.9670	2000.0000	  2.9525
  2.3693	2000.0000	  2.8858
  2.7716	2000.0000	  2.8013
  3.1740	2000.0000	  2.7078
  3.5316	2000.0000	  2.6011
  3.9340	2000.0000	  2.4854
  4.3363	2000.0000	  2.3609
  4.7386	2000.0000	  2.2230
  5.1410	2000.0000	  2.0718
  5.5433	2000.0000	  1.9116
  5.9009	2000.0000	  1.7381
  6.3033	2000.0000	  1.5513
  6.7056	2000.0000	  1.3556
  7.1079	2000.0000	  1.1599
  7.5103	2000.0000	  0.9552
  7.9126	2000.0000	  0.7506
  8.2702	2000.0000	  0.5371
  8.6726	2000.0000	  0.3236
  9.0749	2000.0000	  0.1012
  9.4772	2000.0000	 -0.1212
  9.8796	2000.0000	 -0.3525
 10.2819	2000.0000	 -0.5838
 10.6396	2000.0000	 -0.8196
 11.0419	2000.0000	 -1.0598
 11.4442	2000.0000	 -1.3000];

table2 = [  0.0000	3000.0000	  6.7951
  0.5812	3000.0000	  6.7639
  1.1623	3000.0000	  6.7195
  1.7882	3000.0000	  6.6527
  2.3693	3000.0000	  6.5638
  2.9505	3000.0000	  6.4437
  3.5316	3000.0000	  6.2924
  4.1575	3000.0000	  6.1101
  4.7386	3000.0000	  5.9010
  5.3198	3000.0000	  5.6652
  5.9009	3000.0000	  5.4028
  6.5268	3000.0000	  5.1226
  7.1079	3000.0000	  4.8112
  7.6891	3000.0000	  4.4776
  8.2702	3000.0000	  4.1173
  8.8961	3000.0000	  3.7258
  9.4772	3000.0000	  3.3032
 10.0584	3000.0000	  2.8673
 10.6396	3000.0000	  2.4225
 11.2207	3000.0000	  1.9688
 11.8466	3000.0000	  1.5017
 12.4277	3000.0000	  1.0302
 13.0089	3000.0000	  0.5409
 13.5900	3000.0000	  0.0471
 14.2159	3000.0000	 -0.4600
 14.7970	3000.0000	 -0.9760
 15.3782	3000.0000	 -1.5008
 15.9593	3000.0000	 -2.0346
 16.5852	3000.0000	 -2.5773
 17.1663	3000.0000	 -3.1200];

table3 = [  0.0000	4000.0000	 12.7972
  0.8047	4000.0000	 12.7438
  1.5646	4000.0000	 12.6727
  2.3693	4000.0000	 12.5659
  3.1740	4000.0000	 12.4147
  3.9340	4000.0000	 12.2056
  4.7386	4000.0000	 11.9387
  5.4986	4000.0000	 11.6184
  6.3033	4000.0000	 11.2448
  7.1079	4000.0000	 10.8267
  7.8679	4000.0000	 10.3596
  8.6726	4000.0000	  9.8525
  9.4772	4000.0000	  9.2965
 10.2372	4000.0000	  8.7004
 11.0419	4000.0000	  8.0510
 11.8466	4000.0000	  7.3526
 12.6065	4000.0000	  6.6009
 13.4112	4000.0000	  5.8224
 14.2159	4000.0000	  5.0217
 14.9758	4000.0000	  4.2033
 15.7805	4000.0000	  3.3714
 16.5405	4000.0000	  2.5218
 17.3452	4000.0000	  1.6544
 18.1498	4000.0000	  0.7737
 18.9098	4000.0000	 -0.1293
 19.7145	4000.0000	 -1.0456
 20.5191	4000.0000	 -1.9842
 21.2791	4000.0000	 -2.9406
 22.0838	4000.0000	 -3.9058
 22.8884	4000.0000	 -4.8844];

table4 = [  0.0000	5000.0000	 20.9962
  0.9835	5000.0000	 20.9205
  1.9670	5000.0000	 20.8093
  2.9505	5000.0000	 20.6448
  3.9340	5000.0000	 20.4001
  4.9174	5000.0000	 20.0531
  5.9009	5000.0000	 19.6039
  6.8844	5000.0000	 19.0612
  7.8679	5000.0000	 18.4384
  8.8514	5000.0000	 17.7445
  9.8349	5000.0000	 16.9794
 10.8184	5000.0000	 16.1432
 11.8019	5000.0000	 15.2313
 12.8300	5000.0000	 14.2571
 13.8135	5000.0000	 13.2118
 14.7970	5000.0000	 12.0864
 15.7805	5000.0000	 10.8854
 16.7640	5000.0000	  9.6621
 17.7475	5000.0000	  8.4033
 18.7310	5000.0000	  7.1177
 19.7145	5000.0000	  5.7966
 20.6980	5000.0000	  4.4532
 21.6814	5000.0000	  3.0876
 22.6649	5000.0000	  1.6953
 23.6484	5000.0000	  0.2808
 24.6319	5000.0000	 -1.1693
 25.6154	5000.0000	 -2.6461
 26.5989	5000.0000	 -4.1496
 27.5824	5000.0000	 -5.6754
 28.5659	5000.0000	 -7.2189];

table5 = [  0.0000	6000.0000	 29.6018
  1.1623	6000.0000	 29.4950
  2.3693	6000.0000	 29.3482
  3.5316	6000.0000	 29.1303
  4.7386	6000.0000	 28.8056
  5.9009	6000.0000	 28.3252
  7.1079	6000.0000	 27.6579
  8.2702	6000.0000	 26.8350
  9.4772	6000.0000	 25.8786
 10.6396	6000.0000	 24.8155
 11.8019	6000.0000	 23.6590
 13.0089	6000.0000	 22.4001
 14.1712	6000.0000	 21.0345
 15.3782	6000.0000	 19.5711
 16.5405	6000.0000	 18.0097
 17.7475	6000.0000	 16.3461
 18.9098	6000.0000	 14.5802
 20.1168	6000.0000	 12.7875
 21.2791	6000.0000	 10.9549
 22.4414	6000.0000	  9.0777
 23.6484	6000.0000	  7.1605
 24.8107	6000.0000	  5.2033
 26.0177	6000.0000	  3.2149
 27.1800	6000.0000	  1.1955
 28.3870	6000.0000	 -0.8774
 29.5493	6000.0000	 -2.9903
 30.7116	6000.0000	 -5.1388
 31.9187	6000.0000	 -7.3273
 33.0810	6000.0000	 -9.5470
 34.2880	6000.0000	-11.7889];

table6 = [  0.0000	7000.0000	 37.8542
  1.3858	7000.0000	 37.7252
  2.7716	7000.0000	 37.5339
  4.1575	7000.0000	 37.2759
  5.4986	7000.0000	 36.8801
  6.8844	7000.0000	 36.3107
  8.2702	7000.0000	 35.4299
  9.6561	7000.0000	 34.2645
 11.0419	7000.0000	 32.8989
 12.4277	7000.0000	 31.3732
 13.7688	7000.0000	 29.7229
 15.1547	7000.0000	 27.9391
 16.5405	7000.0000	 25.9953
 17.9263	7000.0000	 23.9224
 19.3121	7000.0000	 21.7250
 20.6980	7000.0000	 19.3896
 22.0391	7000.0000	 16.9298
 23.4249	7000.0000	 14.4521
 24.8107	7000.0000	 11.9255
 26.1965	7000.0000	  9.3367
 27.5824	7000.0000	  6.6944
 28.9682	7000.0000	  3.9899
 30.3540	7000.0000	  1.2365
 31.6951	7000.0000	 -1.5659
 33.0810	7000.0000	 -4.4172
 34.4668	7000.0000	 -7.3353
 35.8526	7000.0000	-10.3067
 37.2384	7000.0000	-13.3270
 38.6243	7000.0000	-16.3874
 39.9654	7000.0000	-19.4833];

rpm_test_sort = sort(rpm_test,1,'ascend');

Throttle = max(min(Throttle,2000),1000);
rpmeng   = interp1(rpm_test_sort(:,1),rpm_test_sort(:,2),Throttle,'linear','extrap');

tabmin   = max(min(floor(rpmeng/1000)-1,5),0);
tabmax   = max(min(ceil(rpmeng/1000)-1,6),1);
cmdmin   = eval(['table' num2str(tabmin) ';']);
cmdmax   = eval(['table' num2str(tabmax) ';']);
Tmin     = interp1(cmdmin(:,1),cmdmin(:,3),V,'linear','extrap');
Tmax     = interp1(cmdmax(:,1),cmdmax(:,3),V,'linear','extrap');

Tp = interp1([(tabmin+1)*1000 (tabmax+1)*1000],[Tmin Tmax],rpmeng,'linear','extrap');
